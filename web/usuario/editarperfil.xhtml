<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:define name="titulo">Usuarios Editar Mi Perfil</ui:define>

<h:body>
    <ui:define name="titulo">Editar Mi Perfil</ui:define>
    <!-- Aside Izq de la pagina -->
    <ui:composition template="/template/common/commonLayout.xhtml">

        <ui:define name="aside">

            <div class="panel-group shadow" id="accordion" role="tablist" aria-multiselectable="true">

                <div class="panel panel-default">

                    <div class="panel-heading active" role="tab" id="headingOne">
                        <h6 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                               aria-expanded="false" aria-controls="collapseOne"><i class="fa fa-user"
                                                                                    aria-hidden="true"></i>
                                Perfil <span class="caret"></span>
                            </a>
                        </h6>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body ">
                            <a href="#{request.contextPath}/usuario/perfil.xhtml">Mi perfil</a>
                        </div>
                        <div class="panel-body active">
                            <a href="#{request.contextPath}/usuario/editarperfil.xhtml">Editar mi perfil</a>
                        </div>
                    </div>
                    <ui:fragment rendered="#{controllerSession.usuario.codRol.nombreRol ne 'Usuario'}">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <h6 class="panel-title"><i class="fa fa-users" aria-hidden="true"></i>
                                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapsTwo"
                                   aria-expanded="true" aria-controls="collapseOne">
                                    Usuarios en el sistema<span class="caret"></span>
                                </a>
                            </h6>
                        </div>

                        <div id="collapsTwo" class="panel-collapse collapse of" role="tabpanel"
                             aria-labelledby="headingOne">
                            <div class="panel-body ">
                                <a href="#{request.contextPath}/usuario/consultarusuarios.xhtml">Consultar Usuarios</a>
                            </div>
                            <div class="panel-body">
                                <h:form>
                                    <a href="#{request.contextPath}/usuario/crearusuario.xhtml">Añadir nuevo usuario</a>
                                </h:form>
                            </div>
                        </div>
                    </ui:fragment>
                </div>

            </div>

        </ui:define>


        <!-- Contenido de la pagina -->
        <ui:define name="content">
            <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9 shadow" id="right-container">
                <!-- Titulo -->
                <h4 class="page-title">
                    #{msg['edit-profile']}
                </h4>
                <div class="row">
                    <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 custom-col-lg-3">
                        <div class="photo">
                            <a href="#">
                                <div style="background-image: url(#{request.contextPath}/resources/imgs/Neurapia.jpg);"
                                     class="img-circle">

                                </div>
                            </a>
                        </div>
                        <div class="basic-information">
                            <h2 class="text-center">
                                <strong>
                                    #{controllerSession.usuario.fullNameUsuario}
                                </strong>
                            </h2>
                            <div>
                                <table>
                                    <tr>
                                        <th>Tipo de usuario:</th>
                                        <td>#{controllerSession.usuario.codRol.nombreRol}</td>
                                    </tr>
                                    <tr>
                                        <th>Estado:</th>
                                        <td>#{controllerSession.usuario.estadoUsuario}</td>
                                    </tr>
                                    <tr>
                                        <th>Miembro desde:</th>
                                        <td>
                                            <h:outputText value="#{controllerSession.usuario.fechaRegistro}">
                                                <f:convertDateTime pattern="yyyy-MM-dd"/>
                                            </h:outputText>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9 col-md-6 col-sm-6 col-xs-12 custom-col-lg-9">
                        <h:form prependId="false" id="editar-perfil" a:name="editar-perfil">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                                <h:messages showDetail="false" showSummary="true" infoClass="alert alert-sucess"
                                            errorClass="alert alert-danger" globalOnly="false"/>
                            </div>
                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Tipo Documento:" for="tipo-documento"/>
                                <h:selectOneMenu disabled="true" id="tipo-documento" class="form-control mitooltip"
                                                 value="#{controllerSession.usuario.tipoDocumento}">
                                    <f:selectItems class="form-control mitooltip"
                                                   value="#{controllerSession.usuario.seleccionDocumento}"/>
                                </h:selectOneMenu>
                            </div>

                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Número Documento:" for="numero-documento"/>
                                <h:inputText disabled="true" class="form-control mitooltip" id="numero-documento"
                                             value="#{controllerSession.usuario.numeroDocumento}">
                                </h:inputText>
                            </div>

                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Primer Nombre:" for="primer-nombre"/>
                                <h:inputText a:placeholder="Primer Nombre" a:type="text" class="form-control mitooltip"
                                             tabindex="1" id="primer-nombre" name="primer-nombre"
                                             value="#{controllerSession.usuario.primerNombre}" required="true"
                                             requiredMessage="El campo 'Primer nombre' es obligatorio." maxlength="45"
                                             validatorMessage="Se ha excedido el número de carácteres permitidos(45) para el campo 'Primer nombre'">
                                </h:inputText>
                            </div>
                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Segundo Nombre:" for="segundo-nombre"/>
                                <h:inputText a:placeholder="Segundo Nombre" a:type="text" class="form-control mitooltip"
                                             tabindex="2" id="segundo-nombre" name="segundo-nombre"
                                             value="#{controllerSession.usuario.segundoNombre}"
                                             required="false" maxlength="45"
                                             validatorMessage="Se ha excedido el número de carácteres permitidos(45) para el campo 'Segundo nombre'">
                                </h:inputText>
                            </div>
                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Primer Apellido:" for="primer-apellido"/>
                                <h:inputText a:placeholder="Primer Apellido" a:type="text"
                                             class="form-control mitooltip" tabindex="3" id="primer-apellido"
                                             name="primer-apellido"
                                             value="#{controllerSession.usuario.primerApellido}"
                                             required="true"
                                             requiredMessage="El campo 'Primer apellido' es obligatorio."
                                             maxlength="45"
                                             validatorMessage="Se ha excedido el número de carácteres permitidos(45) para el campo 'Primer apellido'">
                                </h:inputText>
                            </div>

                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Segundo Apellido:" for="segundo-apellido"/>
                                <h:inputText a:placeholder="Segundo Apellido" a:type="text"
                                             class="form-control mitooltip" tabindex="4" id="segundo-apellido"
                                             name="segundo-apellido"
                                             value="#{controllerSession.usuario.segundoApellido}" required="false"
                                             maxlength="45"
                                             validatorMessage="Se ha excedido el número de carácteres permitidos(45) para el campo 'Segundo apellido'">
                                </h:inputText>
                            </div>

                            <div class="form-group col-lg-12">
                                <h:outputLabel value="Correo Electrónico:" for="correo"/>
                                <h:inputText id="correo" tabindex="8" a:type="email" class="form-control"
                                             a:placeholder="ejem@ejem.com" name="correo"
                                             value="#{controllerSession.usuario.correoElectronico}" required="true"
                                             requiredMessage="El campo 'Correo electrónico' es obligatorio.">
                                </h:inputText>
                            </div>

                            <div class="col-lg-12">
                                <br></br>
                                <h:commandButton class="btn btn-primary" action="#{controllerUsuario.editarPerfil()}"
                                                 value="Guardar"/>&nbsp;
                                <button type="button" class="btn btn-default"
                                        onclick="$('#password').modal('show')">Cambiar contraseña
                                </button>
                            </div>
                        </h:form>
                    </div>
                </div>

                <div class="modal fade" tabindex="-1" role="dialog"
                     aria-labelledby="myLargeModalLabel" id="password">
                    <div class="modal-dialog modal-sm" role="document">
                        <h:form prependId="false" id="cambiar-contrasena" styleClass="custom-modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h1 class="modal-title" id="myModalLabel">Cambiar contraseña</h1>
                                </div>

                                <div class="modal-body">

                                    <div class="col-lg-12 col-md-12 col-sm-12">
                                        <h:messages showDetail="true"
                                                    showSummary="true" styleClass="alert alert-danger" globalOnly="false" style="list-style: none"/>
                                    </div>

                                    <div class="form-group col-lg-12">
                                        <h:outputLabel value="Contraseña anterior:" for="claveUsuario"/>
                                        <h:inputSecret id="contrasena-anterior" class="form-control mitooltip"
                                                       tabindex="1" name="contrasena-anterior" required="true"
                                                       requiredMessage="El campo 'Contraseña anterior es obligatorio.'"
                                                       value="#{controllerUsuario.claveAnterior}">
                                        </h:inputSecret>
                                    </div>

                                    <div class="form-group col-lg-12">
                                        <h:outputLabel value="#{msg['user-password']}:" for="nueva-contrasena"/>
                                        <h:inputSecret id="nueva-contrasena" class="form-control mitooltip"
                                                       tabindex="2" maxlength="25" name="nueva-contrasena"
                                                       value="#{controllerSession.usuario.claveUsuario}"
                                                       required="true"
                                                       requiredMessage="El campo 'Nueva contraseña' es obligatorio."
                                                       validatorMessage="Se ha excedido el número de carácteres permitidos(25) para el campo 'Nueva contraseña.'">
                                        </h:inputSecret>
                                    </div>

                                    <div class="form-group col-lg-12">
                                        <h:outputLabel value="#{msg['confirm-password']}" for="confirmarclave"/>
                                        <h:inputSecret id="confirmar-contrasena" class="form-control mitooltip"
                                                       tabindex="10" maxlength="25" name="confirmar-contrasena"
                                                       requiredMessage="El campo 'Confirmar contraseña' es obligatorio."
                                                       value="#{controllerUsuario.confirmarClave}">
                                        </h:inputSecret>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <div class="col-lg-12 col-md-12 col-sm-12">
                                        <h:commandButton class="btn btn-primary" type="submit" value="#{msg['save']}"
                                                         action="#{controllerUsuario.cambiarContrasena()}">
                                        </h:commandButton>
                                    </div>
                                </div>
                            </div>
                        </h:form>
                    </div>
                </div>
            </div>

        </ui:define>

        <ui:define name="ultimosScripts">
            <script type="text/javascript">
                $(document).ready(function () {
                    $("#lista-usuarios").DataTable({
                        language: {
                            url: "#{resource['js/spanish.lang']}"
                        },
                        dom: "Bfrtip",
                        buttons: [
                            {
                                extend: "csv",
                                className: "btn-sm"
                            },
                            {
                                extend: "excel",
                                className: "btn-sm"
                            },
                            {
                                extend: "pdfHtml5",
                                className: "btn-sm"
                            }
                        ]
                    });

                    $(".btnModal").click(function () {
                        console.log("imprime");
                        $("#myModal").modal("show");
                    });

                    $.validator.addMethod("alphabet", function (value, element, pattern) {
                        return pattern.test(value);
                    });

                    $.validator.addMethod("email", function (value, element, pattern) {
                        return pattern.test(value);
                    });

                    $('#editar-perfil').validate({
                        rules: {
                            'primer-nombre': {
                                required: true,
                                alphabet: /^[a-zA-ZáéíóúÁÉÍÓÚ]+$/,
                                maxlength: 45
                            },
                            'segundo-nombre': {
                                alphabet: /^[a-zA-ZáéíóúÁÉÍÓÚ]*$/,
                                maxlength: 45
                            },
                            'primer-apellido': {
                                required: true,
                                alphabet: /^[a-zA-ZáéíóúÁÉÍÓÚ]+$/,
                                maxlength: 45
                            },
                            'segundo-apellido': {
                                alphabet: /^[a-zA-ZáéíóúÁÉÍÓÚ]*$/,
                                maxlength: 45
                            },
                            correo: {
                                required: true,
                                email: /[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*@[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{1,5}/,
                                maxlength: 45
                            },
                        }, messages: {
                            'numero-documento': {
                                required: 'El campo es obligatorio.',
                                number: 'Sólo se permiten carácteres numéricos.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(20).'
                            },
                            'primer-nombre': {
                                required: 'El campo es obligatorio.',
                                alphabet: 'No se permiten carácteres que no pertenezcan al alfabeto.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(45).'
                            },
                            'segundo-nombre': {
                                alphabet: 'No se permiten carácteres que no pertenezcan al alfabeto.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(45).'
                            },
                            'primer-apellido': {
                                required: 'El campo es obligatorio.',
                                alphabet: 'No se permiten carácteres que no pertenezcan al alfabeto.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(45).'
                            },
                            'segundo-apellido': {
                                alphabet: 'No se permiten carácteres que no pertenezcan al alfabeto.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(45).'
                            },
                            correo: {
                                required: 'El campo es obligatorio.',
                                email: 'Introduzca una dirección de email válida.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(45).'
                            },
                        }
                    })

                    $('#cambiar-contrasena').validate({
                        rules: {
                            'contrasena-anterior': {
                                required: true
                            },
                            'nueva-contrasena': {
                                required: true,
                                minlength: 8,
                                maxlength: 45
                            },
                            'confirmar-contrasena': {
                                required: 'true',
                                equalTo: '#nueva-contrasena'
                            }
                        },
                        messages: {
                            'contrasena-anterior': {
                                required: 'El campo es obligatorio.'
                            },
                            'nueva-contrasena': {
                                required: 'El campo es obligatorio.',
                                minlength: 'La contraseña debe contener mínimo 8 carácteres.',
                                maxlength: 'Se ha excedido el número de carácteres permitidos(45).'
                            },
                            'confirmar-contrasena': {
                                required: 'El campo es obligatorio.',
                                equalTo: 'Las contraseñas no coinciden.'
                            }
                        }
                    })
                });
            </script>
        </ui:define>

    </ui:composition>

</h:body>

</html>


