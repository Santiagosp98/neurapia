<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:define name="titulo">Usuarios consultar Usuarios</ui:define>

<h:body>
    <ui:define name="titulo">Consultar Uusuarios</ui:define>
    <!-- Aside Izq de la pagina -->
    <ui:composition template="/template/common/commonLayout.xhtml">

        <ui:define name="aside">

            <div class="panel-group sombraAside" id="accordion" role="tablist" aria-multiselectable="true">

                <div class="panel panel-default">

                    <div class="panel-heading" role="tab" id="headingOne">
                        <h6 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                               aria-expanded="false" aria-controls="collapseOne"><i class="fa fa-user"
                                                                                    aria-hidden="true"></i>
                                Perfil <span class="caret"></span>
                            </a>
                        </h6>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse of" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body">
                            <a href="#">Mi perfil</a>
                        </div>
                        <div class="panel-body">
                            <a href="#">Editar mi perfil</a>
                        </div>
                    </div>

                    <div class="panel-heading active" role="tab" id="headingOne">
                        <h6 class="panel-title"><i class="fa fa-users" aria-hidden="true"></i>
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapsTwo"
                               aria-expanded="true" aria-controls="collapseOne">
                                Usuarios en el sistema<span class="caret"></span>
                            </a>
                        </h6>
                    </div>

                    <div id="collapsTwo" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body active">
                            <a href="#{request.contextPath}/Usuarios/ConsultarUsuarios.xhtml">Consultar Usuarios</a>
                        </div>
                        <div class="panel-body">
                            <h:form>
                                <a href="#{request.contextPath}/Usuarios/CrearUsuario.xhtml">Añadir nuevo usuario</a>
                            </h:form>
                        </div>
                    </div>

                </div>

            </div>

        </ui:define>


        <!-- Contenido de la pagina -->
        <ui:define name="content">
            <div class="contenedorderecho col-xs-12 col-sm-12 col-md-9 col-lg-9 sombraAside">
                <!-- Titulo -->
                <h5 id="ubicacionPag">Usuarios en el sistema</h5>

                <div class="fixed-table-body">
                    <h:form prependId="false">
                        <h:messages showSummary="true" showDetail="true"/>
                        <h:dataTable value="#{controllerUsuario.consultarUsuarios()}" var="item"
                                     class="table table-striped table-bordered" id="lista-usuarios">
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Documento"/>
                                </f:facet>
                                <h:outputText value="#{item.numeroDocumento}"/>
                            </h:column>>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Nombre"/>
                                </f:facet>

                                <h:outputText value="#{item.fullNameUsuario}"/>
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Estado"/>
                                </f:facet>
                                <h:outputText value="#{item.estadoUsuario}"/>
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Rol"/>
                                </f:facet>
                                <h:outputText value="#{item.codRol.nombreRol}"/>
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Fecha"/>
                                </f:facet>
                                <h:outputText value="#{item.fechaRegistro}">
                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                </h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Correo"/>
                                </f:facet>
                                <h:outputText value="#{item.correoElectronico}"/>
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="Acciones"/>
                                </f:facet>
                                &nbsp;
                                <h:commandLink action="#{controllerUsuario.seleccionarUsuario(item)}" value=""><span
                                        id="botonEdita" class="fa fa-pencil-square-o" aria-hidden="true"></span>
                                </h:commandLink>
                                &nbsp;
                                <h:commandLink id="botonElimina" class="btnModal" value=""><span id="botonElimina"
                                                                                                 class="fa fa-times"
                                                                                                 aria-hidden="true"></span>
                                    <f:ajax event="click" listener="#{controllerUsuario.prepararEliminarUsuario(item)}"
                                            render=":form-eliminar-user"/>
                                </h:commandLink>
                                &nbsp;
                                <h:commandLink rendered="#{item.codRol.idRol eq 4}"
                                               action="#{controllerUsuario.prepararCrearHistorial(item)}">
                                    <span class="fa fa-stethoscope" aria-hidden="true"></span>
                                </h:commandLink>
                            </h:column>
                        </h:dataTable>
                    </h:form>
                </div>
            </div>

            <div id="myModal" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <h:form id="form-eliminar-user" prependId="false">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Confirmación eliminar Usuario</h4>
                            </div>
                            <div class="modal-body">
                                <p>¿Está seguro que desea eliminar el usuario
                                    <b>#{controllerUsuario.usuario.fullNameUsuario}</b>?</p>
                            </div>
                            <div class="modal-footer">
                                <h:commandButton class="btn btn-primary" value="Eliminar"
                                                 action="#{controllerUsuario.eliminarUsuario()}"></h:commandButton>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>

        </ui:define>

        <ui:define name="ultimosScripts">
            <script>
                $(document).ready(function () {
                    $("#lista-usuarios").DataTable({
                        autoWidth: false,
                        language: {
                            url: "#{resource['js/spanish.lang']}"
                        },
                        responsive: true,
                        columnDefs:[
                            { responsivePriority: 1, targets: -1 },
                            { responsivePriority: 2, targets: 1 }
                        ],
                        dom: "Bfrtip",
                        buttons: [
                            {
                                extend: "csv",
                                className: "btn-sm"
                            },
                            {
                                extend: "excel",
                                className: "btn-sm"
                            },
                            {
                                extend: "pdfHtml5",
                                className: "btn-sm"
                            }
                        ]
                    });

                    $(".btnModal").click(function () {
                        console.log("imprime");
                        $("#myModal").modal("show");
                    });
                });
            </script>
        </ui:define>

    </ui:composition>

</h:body>

</html>


